{% extends "base/base.html" %}
{% load static %}
{% block extra_head_js %}
<script>
  (function () {
    window.onload = function () {
      var preloader = document.querySelector('.page-loading');
      if (preloader) { preloader.classList.remove('active'); setTimeout(function () { preloader.remove(); }, 500); }
    };
  })();
</script>
{% endblock extra_head_js %}
{% block body %}
<main class="page-wrapper">
  {% include "partials/loading_spinner.html" %}
  {% include "partials/header.html" %}

  <div class="container mt-5 mb-md-2 mb-lg-4 py-5">
    {% include "partials/breadcrumbs.html" %}

    <h1 class="h4 pb-3 font-vazir">{{ seo_h1 }}</h1>
    {% if post.cover_image %}
    <img class="rounded-3 w-100" src="{{ post.cover_image.url }}" alt="{{ post.title }}" style="max-height: 400px; object-fit: cover;">
    {% else %}
    <div class="rounded-3 bg-secondary d-flex align-items-center justify-content-center mb-3" style="height: 280px;"><i class="fi-file-text display-4 text-muted opacity-50"></i></div>
    {% endif %}

    <div class="row mt-4 pt-3">
      <aside class="col-lg-4">
        <div class="offcanvas-lg offcanvas-end pe-lg-3" id="blog-sidebar">
          <div class="offcanvas-header shadow-sm mb-2">
            <h3 class="h5 offcanvas-title">سایدبار</h3>
            <button class="btn-close" type="button" data-bs-dismiss="offcanvas"></button>
          </div>
          <div class="offcanvas-body">
            <div class="position-relative mb-4">
              <form action="{% url 'blog:index' %}" method="get" class="d-flex">
                <input class="form-control pe-5" type="search" name="q" placeholder="جستجو..." aria-label="جستجو">
                <button type="submit" class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-2 p-0"><i class="fi-search"></i></button>
              </form>
            </div>
            {% if post.author %}
            <div class="card card-flush py-2 py-lg-0 mb-4">
              <div class="card-body d-flex align-items-start">
                {% if post.author.avatar %}
                <img class="me-3 rounded-circle" src="{{ post.author.avatar.url }}" width="80" alt="{{ post.author.get_full_name|default:post.author.username }}">
                {% else %}
                <div class="me-3 rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;"><i class="fi-user fs-2 text-muted"></i></div>
                {% endif %}
                <div>
                  <h4 class="h5 mb-2">{{ post.author.get_full_name|default:post.author.username }}</h4>
                  <span class="d-block mb-3 fs-sm text-muted">نویسنده</span>
                </div>
              </div>
            </div>
            {% endif %}
            <div class="card card-flush pb-2 pb-lg-0 mb-4">
              <div class="card-body">
                <h3 class="h5 font-vazir">دسته‌بندی‌ها</h3>
                <a class="nav-link fw-normal d-flex justify-content-between py-1 px-0" href="{% url 'blog:index' %}">همه</a>
                {% for cat in categories %}
                <a class="nav-link fw-normal d-flex justify-content-between py-1 px-0" href="{{ cat.get_absolute_url }}">{{ cat.fa_name }}<span class="text-muted ms-2">({{ cat.post_count }})</span></a>
                {% endfor %}
              </div>
            </div>
            <div class="card card-flush mb-4">
              <div class="card-body">
                <h4 class="h5 mb-3">اشتراک در خبرنامه</h4>
                <p class="fs-sm mb-3">در خبرنامه ما مشترک شوید و اولین کسی باشید که جدیدترین پست‌ها را مشاهده می‌کنید.</p>
                <form class="form-group rounded-pill" method="get" action="{% url 'blog:index' %}">
                  <div class="input-group input-group-sm"><span class="input-group-text text-muted"><i class="fi-mail"></i></span>
                    <input class="form-control" type="email" name="email" placeholder="ایمیل شما">
                  </div>
                  <button class="btn btn-primary btn-sm rounded-pill mt-2" type="button">ثبت</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div class="col-lg-8 blog-details">
        <div class="d-flex flex-wrap border-bottom pb-3 mb-4">
          {% if post.blog_category %}
          <a class="text-uppercase text-decoration-none border-end pe-3 me-3 mb-2" href="{{ post.blog_category.get_absolute_url }}">{{ post.blog_category.fa_name }}</a>
          {% endif %}
          <div class="d-flex align-items-center border-end pe-3 me-3 mb-2"><i class="fi-calendar-alt opacity-70 me-2"></i><span>{{ post.published_at|date:"j F" }}</span></div>
        </div>

        {% if post.excerpt %}
        <p class="fs-lg text-dark mb-4 font-vazir">{{ post.excerpt }}</p>
        {% endif %}

        {% if landing_links %}
        <div class="alert alert-light border mb-4">
          <strong>مرتبط با:</strong>
          {% for link in landing_links %}
          <a href="{{ link.url }}" class="text-decoration-none me-2">{{ link.title }}</a>{% if not forloop.last %} · {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        <div class="content mb-4">{{ post.content|safe }}</div>

        <div class="pt-4">
          <div class="d-md-flex align-items-center justify-content-between border-top pt-4">
            <div class="d-flex align-items-center me-3 mb-3 mb-md-0">
              <div class="fw-bold text-nowrap pe-2 mb-2">اشتراک‌گذاری:</div>
              <div class="d-flex">
                <a class="btn btn-icon btn-light-primary btn-xs rounded-circle shadow-sm mb-2 ms-2" href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" rel="noopener" data-bs-toggle="tooltip" title="اشتراک در فیسبوک"><i class="fi-facebook"></i></a>
                <a class="btn btn-icon btn-light-primary btn-xs rounded-circle shadow-sm mb-2 ms-2" href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ post.title }}" target="_blank" rel="noopener" data-bs-toggle="tooltip" title="اشتراک در توییتر"><i class="fi-twitter"></i></a>
                <a class="btn btn-icon btn-light-primary btn-xs rounded-circle shadow-sm mb-2 ms-2" href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ post.title }}" target="_blank" rel="noopener" data-bs-toggle="tooltip" title="اشتراک در لینکدین"><i class="fi-linkedin"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if recent_posts %}
    <div class="pt-5 mt-md-4 mb-lg-2">
      <div class="d-sm-flex align-items-center justify-content-between mb-4 pb-2">
        <h2 class="h4 mb-sm-0 font-vazir">ممکن است شما نیز علاقه‌مند باشید</h2>
        <a class="btn btn-link fw-normal ms-sm-3 p-0" href="{% url 'blog:index' %}">لیست مقالات<i class="fi-arrow-long-left ms-2"></i></a>
      </div>
      <div class="tns-carousel-wrapper tns-nav-outside">
        <div class="tns-carousel-inner d-block" data-carousel-options='{"controls": false, "gutter": 24, "autoHeight": true, "responsive": {"0":{"items":1,"nav":true},"500":{"items":2},"850":{"items":3},"1200":{"items":3}}}'>
          {% for r in recent_posts %}
          <article>
            <a class="d-block mb-3" href="{{ r.get_absolute_url }}">
              {% if r.cover_image %}
              <img class="rounded-3 w-100" src="{{ r.cover_image.url }}" alt="{{ r.title }}" style="height: 200px; object-fit: cover;">
              {% else %}
              <div class="rounded-3 bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;"><i class="fi-file-text fs-1 text-muted opacity-50"></i></div>
              {% endif %}
            </a>
            {% if r.blog_category %}
            <a class="fs-sm text-uppercase text-decoration-none" href="{{ r.blog_category.get_absolute_url }}">{{ r.blog_category.fa_name }}</a>
            {% endif %}
            <h3 class="fs-lg pt-1"><a class="nav-link" href="{{ r.get_absolute_url }}">{{ r.title }}</a></h3>
            <a class="d-flex align-items-center text-decoration-none" href="{{ r.get_absolute_url }}">
              {% if r.author.avatar %}
              <img class="rounded-circle" src="{{ r.author.avatar.url }}" width="44" alt="">
              {% else %}
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 44px; height: 44px;"><i class="fi-user text-muted"></i></div>
              {% endif %}
              <div class="ps-2">
                <h6 class="fs-sm text-nav lh-base mb-1">{{ r.author.get_full_name|default:r.author.username|default:"نویسنده" }}</h6>
                <div class="d-flex text-body fs-xs"><span><i class="fi-calendar-alt opacity-70 mt-n1 me-1 align-middle"></i>{{ r.published_at|date:"j F" }}</span></div>
              </div>
            </a>
          </article>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  {% include "partials/footer.html" %}
  <button class="btn btn-primary btn-sm w-100 rounded-0 fixed-bottom d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#blog-sidebar"><i class="fi-sidebar-left me-2"></i>سایدبار</button>
  {% include "partials/Backtotopbutton.html" %}
  {% include "base/scripts.html" %}
</main>
{% endblock body %}
