{% extends "base/base.html" %}
{% load static %}
{% block extra_css %}
{% endblock extra_css %}
{% block extra_head_js %}
<script>
  (function () {
    window.onload = function () {
      var preloader = document.querySelector('.page-loading');
      if (preloader) {
        preloader.classList.remove('active');
        setTimeout(function () { preloader.remove(); }, 500);
      }
    };
  })();
</script>
{% endblock extra_head_js %}
{% block body %}
<main class="page-wrapper">
  {% include "partials/loading_spinner.html" %}
  {% include "partials/SignInModal.html" %}
  {% include "partials/SignUpModal.html" %}
  {% include "partials/header.html" %}

  <div class="container mt-5 pt-md-3 py-4 py-lg-5">
    {% include "partials/breadcrumbs.html" %}

    {% if listing.images.all %}
    <div class="mb-4">
      <div class="row g-2">
        {% for img in listing.images.all %}
        <div class="col-6 col-md-3">
          <a href="{{ img.image.url }}" target="_blank" rel="noopener" class="d-block">
            <img
              src="{{ img.image.url }}"
              class="img-fluid rounded"
              alt="{{ img.alt|default:listing.title }}"
              loading="lazy"
            />
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <h1 class="mb-3">{{ listing.seo_h1|default:listing.title }}</h1>

    <div class="mb-2">
      <strong>شهر:</strong> {{ listing.city.fa_name }}
      {% if listing.area %}
      — <strong>محله:</strong> {{ listing.area.fa_name }}
      {% endif %}
    </div>

    <div class="mb-2">
      <strong>دسته‌بندی:</strong> {{ listing.category.fa_name }}
    </div>

    <div class="mb-2">
      <strong>نوع معامله:</strong>
      {% if listing.deal == 'rent' %}اجاره{% else %}فروش{% endif %}
    </div>

    {% if listing.price %}
    <div class="mb-2">
      <strong>قیمت:</strong> {{ listing.price|floatformat:0 }} {{ listing.price_unit|default:"تومان" }}
    </div>
    {% endif %}

    {% if listing.short_description %}
    <p class="mt-3">{{ listing.short_description }}</p>
    {% endif %}

    {% if listing.description %}
    <div class="mt-4 content">{{ listing.description|safe }}</div>
    {% endif %}
  </div>

  {% include "partials/footer.html" %}
  {% include "partials/Backtotopbutton.html" %}
  {% include "base/scripts.html" %}
</main>
{% endblock body %}
{% block extra_js %}
{% endblock extra_js %}
