{% extends "base/base.html" %}
{% load static %}
{% block extra_css %}
{% endblock extra_css %}
{% block extra_head_js %}
<script>
  (function () {
    window.onload = function () {
      var preloader = document.querySelector('.page-loading');
      if (preloader) {
        preloader.classList.remove('active');
        setTimeout(function () { preloader.remove(); }, 500);
      }
    };
  })();
</script>
{% endblock extra_head_js %}
{% block body %}
<main class="page-wrapper">
  {% include "partials/loading_spinner.html" %}
  {% include "partials/SignInModal.html" %}
  {% include "partials/SignUpModal.html" %}
  {% include "partials/header.html" %}

  <!-- Page header -->
  <section class="container pt-5 mt-5">
    {% include "partials/breadcrumbs.html" %}

    <div class="d-sm-flex align-items-center justify-content-between mb-4 pb-sm-2">
      <h1 class="h2 me-3 mb-sm-0">{{ seo_h1 }}</h1>
      <div class="text-nowrap">
        <div class="dropdown d-inline-block" data-bs-toggle="tooltip" title="اشتراک‌گذاری">
          <button class="btn btn-icon btn-light-primary btn-xs shadow-sm rounded-circle" type="button" data-bs-toggle="dropdown"><i class="fi-share"></i></button>
          <div class="dropdown-menu dropdown-menu-end my-1">
            <button class="dropdown-item" type="button" onclick="shareUrl('facebook')"><i class="fi-facebook fs-base opacity-75 me-2"></i>فیسبوک</button>
            <button class="dropdown-item" type="button" onclick="shareUrl('twitter')"><i class="fi-twitter fs-base opacity-75 me-2"></i>توییتر</button>
            <button class="dropdown-item" type="button" onclick="shareUrl('telegram')"><i class="fi-telegram fs-base opacity-75 me-2"></i>تلگرام</button>
          </div>
        </div>
      </div>
    </div>

    <ul class="nav nav-pills border-bottom pb-3 mb-4">
      <li class="nav-item"><a class="nav-link d-flex align-items-center active" href="#info"><i class="fi-info-circle me-2"></i>اطلاعات</a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="#listings"><i class="fi-list me-2"></i>آگهی‌ها</a></li>
    </ul>
  </section>

  <!-- Main content -->
  <section class="container pb-5 mb-md-4" id="info">
    <div class="row">
      <div class="col-md-7 mb-md-0 mb-4 pb-md-0 pb-2">
        <div class="mb-4">
          <div class="d-flex align-items-center gap-3 p-3 rounded bg-light">
            {% if agent.avatar %}
            <img src="{{ agent.avatar.url }}" alt="{{ display_name }}" class="rounded-circle flex-shrink-0" style="width: 100px; height: 100px; object-fit: cover;">
            {% else %}
            <div class="rounded-circle bg-faded-primary d-flex align-items-center justify-content-center flex-shrink-0" style="width: 100px; height: 100px;">
              <i class="fi-user text-primary fs-1"></i>
            </div>
            {% endif %}
            <div>
              <h2 class="h5 mb-1">{{ display_name }}</h2>
              <p class="text-muted mb-1">{{ agent.get_role_display }}</p>
              {% if agent.phone %}
              <p class="mb-0"><i class="fi-phone mt-n1 me-1 align-middle opacity-70"></i><a href="tel:{{ agent.phone }}">{{ agent.phone }}</a></p>
              {% endif %}
            </div>
          </div>
        </div>

        {% if agencies %}
        <div class="mb-4 pb-md-3">
          <h2 class="h5">محل فعالیت</h2>
          <div class="row g-2">
            {% for agency in agencies %}
            <div class="col-sm-6">
              <a href="{{ agency.get_absolute_url }}" class="d-flex align-items-center gap-2 p-3 rounded bg-light text-decoration-none text-dark card-hover">
                {% if agency.logo %}
                <img src="{{ agency.logo.url }}" alt="{{ agency.name }}" class="rounded flex-shrink-0 object-fit-cover" style="width: 48px; height: 48px;">
                {% else %}
                <div class="rounded bg-faded-primary d-flex align-items-center justify-content-center flex-shrink-0" style="width: 48px; height: 48px;">
                  <i class="fi-building text-primary"></i>
                </div>
                {% endif %}
                <div>
                  <div class="fw-medium">{{ agency.name }}</div>
                  {% if agency.phone %}<small class="text-muted">{{ agency.phone }}</small>{% endif %}
                </div>
                <i class="fi-chevron-left me-2 ms-auto opacity-70"></i>
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <p class="text-muted small mb-0">برای مشاهده آگهی‌های این مشاور به بخش پایین صفحه مراجعه کنید.</p>
      </div>

      <!-- Sidebar -->
      <aside class="col-md-5">
        <div class="card mb-4 p-2 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-start mb-3 pb-2 border-bottom">
              {% if agent.avatar %}
              <img src="{{ agent.avatar.url }}" alt="{{ display_name }}" width="60" height="60" class="rounded-circle flex-shrink-0 object-fit-cover">
              {% else %}
              <div class="rounded-circle bg-faded-primary d-flex align-items-center justify-content-center flex-shrink-0" style="width: 60px; height: 60px;">
                <i class="fi-user text-primary fs-3"></i>
              </div>
              {% endif %}
              <div class="ps-2 ms-1">
                <h3 class="h5 mb-2">{{ display_name }}</h3>
                <p class="text-muted small mb-1">{{ agent.get_role_display }}</p>
                {% if agent.phone %}
                <a href="tel:{{ agent.phone }}" class="d-inline-flex align-items-center"><i class="fi-phone mt-n1 me-1 align-middle opacity-70"></i>{{ agent.phone }}</a>
                {% endif %}
              </div>
            </div>
            {% if agent.phone %}
            <div class="mb-0">
              <a class="btn btn-primary btn-lg rounded-pill w-100" href="tel:{{ agent.phone }}"><i class="fi-phone me-2"></i>تماس با مشاور</a>
            </div>
            {% endif %}
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- Listings -->
  <section class="container pb-5 mb-lg-4" id="listings">
    <div class="d-flex align-items-center justify-content-between mb-4 pb-2">
      <h2 class="h3 mb-0">آگهی‌های {{ display_name }}</h2>
      <a class="btn btn-link fw-normal ms-sm-3 p-0" href="{% url 'listing_catalog' %}">مشاهده همه<i class="fi-arrow-long-left ms-2"></i></a>
    </div>
    {% if listings %}
    <div class="row g-4">
      {% for listing in listings %}
      <div class="col-sm-6 col-lg-4 col-xl-3">
        {% include "partials/listing_card.html" %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">فعلاً آگهی‌ای از این مشاور ثبت نشده است.</p>
    {% endif %}
  </section>

  {% include "partials/footer.html" %}
  {% include "partials/Backtotopbutton.html" %}
  {% include "base/scripts.html" %}

  <script>
    function shareUrl(platform) {
      var url = encodeURIComponent(window.location.href);
      var text = encodeURIComponent(document.title);
      var urls = {
        facebook: 'https://www.facebook.com/sharer/sharer.php?u=' + url,
        twitter: 'https://twitter.com/intent/tweet?url=' + url + '&text=' + text,
        telegram: 'https://t.me/share/url?url=' + url + '&text=' + text
      };
      if (urls[platform]) window.open(urls[platform], '_blank', 'width=600,height=400');
    }
  </script>
</main>
{% endblock body %}
{% block extra_js %}
{% endblock extra_js %}
