{% extends "base/base.html" %}
{% load static humanize %}
{% block extra_css %}
{% endblock extra_css %}
{% block extra_head_js %}
<script>
  (function () {
    window.onload = function () {
      var preloader = document.querySelector('.page-loading');
      if (preloader) {
        preloader.classList.remove('active');
        setTimeout(function () { preloader.remove(); }, 500);
      }
    };
  })();
</script>
{% endblock extra_head_js %}
{% block body %}
<main class="page-wrapper">
  {% include "partials/loading_spinner.html" %}
  {% include "partials/SignInModal.html" %}
  {% include "partials/SignUpModal.html" %}
  {% include "partials/header.html" %}

  <!-- Page container - ظاهر real-estate-vendor-properties -->
  <div class="container mt-5 mb-md-4 py-5">
    {% include "partials/breadcrumbs.html" %}

    <div class="row">
      <!-- Sidebar (اطلاعات مشاور) -->
      <aside class="col-lg-3 col-md-4 mb-5">
        <div class="pe-lg-3">
          {% if agent.avatar %}
          <img class="d-block rounded-circle mx-auto mx-md-0 mb-3" src="{{ agent.avatar.url }}" width="120" alt="{{ display_name }}">
          {% else %}
          <div class="d-block rounded-circle mx-auto mx-md-0 mb-3 bg-faded-primary d-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
            <i class="fi-user text-primary fs-1"></i>
          </div>
          {% endif %}
          <h2 class="h4 text-center text-md-start mb-1 font-vazir">{{ display_name }}</h2>
          <p class="text-center text-md-start mb-2 pb-1 text-muted">{{ agent.get_role_display }}</p>
          {% if agencies %}
          <p class="text-center text-md-start mb-2 pb-1 fs-sm">{% for a in agencies %}{{ a.name }}{% if not forloop.last %}، {% endif %}{% endfor %}</p>
          {% endif %}
          <div class="border-bottom pb-4 mb-4"></div>
          {% if agent.phone or agent.email %}
          <ul class="d-table list-unstyled mx-auto mx-md-0 mb-3 mb-md-4">
            {% if agent.phone %}
            <li class="mb-2"><a class="nav-link fw-normal p-0" href="tel:{{ agent.phone }}"><i class="fi-phone text-primary mt-n1 me-2 align-middle"></i>{{ agent.phone }}</a></li>
            {% endif %}
            {% if agent.email %}
            <li><a class="nav-link fw-normal p-0" href="mailto:{{ agent.email }}"><i class="fi-mail text-primary mt-n1 me-2 align-middle"></i>{{ agent.email }}</a></li>
            {% endif %}
          </ul>
          {% endif %}
          <div class="text-center text-md-start pt-md-2 mt-4">
            {% if agent.phone %}
            <a class="btn btn-primary" href="tel:{{ agent.phone }}"><i class="fi-phone fs-sm me-2"></i>تماس با مشاور</a>
            {% endif %}
          </div>
        </div>
      </aside>

      <!-- Content (آگهی‌ها) -->
      <div class="col-lg-9 col-md-8">
        <h1 class="h2 text-end text-sm-start mb-4 font-vazir">ملک‌های پیشنهادی</h1>
        <!-- Nav tabs + Sorting -->
        <div class="d-flex flex-column flex-sm-row align-items-center justify-content-between mb-4">
          <ul class="nav nav-tabs flex-nowrap mb-sm-0" role="tablist">
            <li class="nav-item"><a class="nav-link fs-sm active" href="#for-rent" data-bs-toggle="tab" role="tab" aria-controls="for-rent" aria-selected="true">اجاره</a></li>
            <li class="nav-item"><a class="nav-link fs-sm" href="#for-sale" data-bs-toggle="tab" role="tab" aria-controls="for-sale" aria-selected="false">فروش</a></li>
          </ul>
          <a class="btn btn-link fw-normal ms-sm-4 p-0 fs-sm" href="{% url 'listing_catalog' %}">مشاهده همه <i class="fi-arrow-long-left ms-2"></i></a>
        </div>

        <div class="tab-content">
          <!-- تب اجاره -->
          <div class="tab-pane fade show active" id="for-rent" role="tabpanel">
            <div class="row g-4 g-md-3 g-lg-4 pt-2">
              {% for listing in rent_listings %}
              <div class="col-sm-6 col-lg-4">
                {% include "partials/listing_card.html" %}
              </div>
              {% empty %}
              <div class="col-12 py-4">
                <p class="text-muted text-center">فعلاً آگهی اجاره‌ای از این مشاور ثبت نشده است.</p>
              </div>
              {% endfor %}
            </div>
          </div>
          <!-- تب فروش -->
          <div class="tab-pane fade" id="for-sale" role="tabpanel">
            <div class="row g-4 g-md-3 g-lg-4 pt-2">
              {% for listing in buy_listings %}
              <div class="col-sm-6 col-lg-4">
                {% include "partials/listing_card.html" %}
              </div>
              {% empty %}
              <div class="col-12 py-4">
                <p class="text-muted text-center">فعلاً آگهی فروشی از این مشاور ثبت نشده است.</p>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% include "partials/footer.html" %}
  {% include "partials/Backtotopbutton.html" %}
  {% include "base/scripts.html" %}
</main>
{% endblock body %}
{% block extra_js %}
{% endblock extra_js %}
