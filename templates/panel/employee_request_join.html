{% extends "panel/base.html" %}
{% block panel_content %}
<div class="mb-3">{% include "partials/breadcrumbs.html" %}</div>

<div class="card shadow-sm mb-4">
  <div class="card-body p-4">
    <h2 class="h5 mb-3">دعوت‌های همکاری من</h2>
    <p class="text-muted mb-0">
      برای عضویت در املاک، دعوت همکاری را تایید کنید. تا قبل از تایید شما، عضویت فعال نمی‌شود.
    </p>
  </div>
</div>

<h3 class="h6 mb-3">دعوت‌های در انتظار پاسخ</h3>
{% if pending_invites %}
<div class="card shadow-sm mb-4">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>املاک</th>
          <th>دعوت‌کننده</th>
          <th>تاریخ دعوت</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for inv in pending_invites %}
        <tr>
          <td>{{ inv.agency.name }}</td>
          <td>{{ inv.invited_by.get_full_name|default:inv.invited_by.username }}</td>
          <td>{{ inv.created_at|date:"Y/m/d H:i" }}</td>
          <td class="text-nowrap">
            <form method="post" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="action" value="accept_invite" />
              <input type="hidden" name="invite_id" value="{{ inv.id }}" />
              <button type="submit" class="btn btn-sm btn-success">تایید</button>
            </form>
            <form method="post" class="d-inline" onsubmit="return confirm('این دعوت رد شود؟');">
              {% csrf_token %}
              <input type="hidden" name="action" value="reject_invite" />
              <input type="hidden" name="invite_id" value="{{ inv.id }}" />
              <button type="submit" class="btn btn-sm btn-outline-danger">رد</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="card shadow-sm mb-4">
  <div class="card-body text-center py-4">
    <p class="text-muted mb-0">دعوت همکاری فعالی برای شما وجود ندارد.</p>
  </div>
</div>
{% endif %}

<h3 class="h6 mb-3">سوابق دعوت‌ها</h3>
{% if invite_history %}
<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-sm mb-0">
      <thead class="table-light">
        <tr>
          <th>املاک</th>
          <th>دعوت‌کننده</th>
          <th>وضعیت</th>
          <th>تاریخ</th>
        </tr>
      </thead>
      <tbody>
        {% for inv in invite_history %}
        <tr>
          <td>{{ inv.agency.name }}</td>
          <td>{{ inv.invited_by.get_full_name|default:inv.invited_by.username }}</td>
          <td>
            {% if inv.status == 'accepted' %}
            <span class="badge bg-success">تایید شده</span>
            {% elif inv.status == 'rejected' %}
            <span class="badge bg-danger">رد شده</span>
            {% else %}
            <span class="badge bg-secondary">لغو شده</span>
            {% endif %}
          </td>
          <td>{{ inv.created_at|date:"Y/m/d H:i" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="card shadow-sm">
  <div class="card-body text-center py-4">
    <p class="text-muted mb-0">سابقه‌ای برای دعوت‌های همکاری ثبت نشده است.</p>
  </div>
</div>
{% endif %}
{% endblock %}
