{% load static humanize %}
<!-- Recently added - ملک‌های جدید -->
<section class="container pb-4 pt-1 mb-5">
  <div class="d-flex align-items-end align-items-lg-center justify-content-between mb-4 pb-md-2">
    <h2 class="h3 mb-0 me-md-4">ملک های جدید اضافه شده</h2>
    <a class="btn btn-link fw-normal d-none d-lg-block p-0" href="{% url 'listing_catalog' %}">مشاهده همه <i class="fi-arrow-long-left me-2"></i></a>
  </div>
  {% if recent_listings %}
  <div class="tns-carousel-wrapper tns-controls-outside tns-nav-outside tns-nav-outside-flush">
    <div class="tns-carousel-inner row g-4 mx-0" data-carousel-options='{"items": 3, "responsive": {"0":{"items":1},"500":{"items":2},"768":{"items":3}}}'>
      {% for item in recent_listings %}
      <div class="col">
        <div class="card shadow-sm card-hover border-0 h-100">
          <div class="card-img-top card-img-hover">
            <a class="img-overlay" href="{{ item.get_absolute_url }}"></a>
            {% for img in item.images.all %}
              {% if forloop.first %}
            <img src="{{ img.image.url }}" alt="{{ img.alt|default:item.title }}" loading="lazy" style="height: 220px; object-fit: cover;">
              {% endif %}
            {% empty %}
            <div class="bg-secondary d-flex align-items-center justify-content-center" style="height: 220px;">
              <i class="fi-home fs-1 text-muted opacity-50"></i>
            </div>
            {% endfor %}
          </div>
          <div class="card-body position-relative pb-3">
            <h4 class="mb-1 fs-xs fw-normal text-uppercase text-primary">{{ item.get_deal_display_fa }}</h4>
            <h3 class="h6 mb-2 fs-base"><a class="nav-link stretched-link" href="{{ item.get_absolute_url }}">{{ item.title }}</a></h3>
            <p class="mb-2 fs-sm text-muted">{{ item.city.fa_name }}{% if item.area %}، {{ item.area.fa_name }}{% endif %}</p>
            <div class="fw-bold"><i class="fi-cash mt-n1 me-2 lead align-middle opacity-70"></i>{% if item.has_price_display %}{% if item.deal == 'mortgage_rent' %}{% if item.price_mortgage %}رهن {{ item.price_mortgage|floatformat:0|intcomma }}{% endif %}{% if item.price_mortgage and item.price %} | {% endif %}{% if item.price %}اجاره {{ item.price|floatformat:0|intcomma }}{% endif %}{% else %}{{ item.price|floatformat:0|intcomma }}{% endif %} {{ item.price_unit|default:"تومان" }}{% else %}تماس{% endif %}</div>
          </div>
          <div class="card-footer d-flex align-items-center justify-content-center mx-3 pt-2 pb-3 text-nowrap border-0">
            {% for av in item.attribute_values.all %}
              {% if av.value_int is not None or av.value_bool or av.value_option_id %}
            <span class="d-inline-flex align-items-center mx-1 px-2 fs-sm">
              {% if av.attribute.icon %}<img src="{{ av.attribute.icon.url }}" alt="{{ av.attribute.name }}" class="me-1" style="width:18px;height:18px;object-fit:contain">{% endif %}
              {{ av.display_value }}
            </span>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <p class="text-muted text-center py-5">هنوز آگهی منتشرشده‌ای ثبت نشده است.</p>
  {% endif %}
</section>
