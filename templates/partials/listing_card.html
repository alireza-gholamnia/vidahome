{% load static humanize %}
{# Expects: listing (with images, category, title, deal, price, etc.) #}
<div class="card shadow-sm card-hover border-0 h-100">
  <div class="card-img-top card-img-hover">
    <a class="img-overlay" href="{{ listing.get_absolute_url }}"></a>
    <div class="position-absolute start-0 top-0 pt-3 ps-3">
      <span class="d-table badge mb-1 {% if listing.deal == 'rent' or listing.deal == 'daily_rent' %}bg-info{% elif listing.deal == 'mortgage_rent' %}bg-warning text-dark{% else %}bg-primary{% endif %}">
        {{ listing.get_deal_display_fa }}
      </span>
    </div>
    <div class="content-overlay end-0 top-0 pt-3 pe-3">
      <a
        class="btn btn-icon btn-light btn-xs text-primary rounded-circle"
        href="{{ listing.get_absolute_url }}"
        data-bs-toggle="tooltip"
        data-bs-placement="left"
        title="مشاهده جزئیات"
      >
        <i class="fi-eye"></i>
      </a>
    </div>
    {% for img in listing.images.all %}
      {% if forloop.first %}
    <img src="{{ img.image.url }}" alt="{{ img.alt|default:listing.title }}" loading="lazy" />
      {% endif %}
    {% empty %}
    <div class="bg-secondary d-flex align-items-center justify-content-center" style="min-height: 180px;">
      <i class="fi-home fs-1 text-muted opacity-50"></i>
    </div>
    {% endfor %}
  </div>
  <div class="card-body position-relative pb-3">
    <h4 class="mb-1 fs-sm fw-normal text-uppercase text-primary">
      {{ listing.category.fa_name }}
    </h4>
    <h3 class="h6 mb-2 fs-base">
      <a class="nav-link stretched-link" href="{{ listing.get_absolute_url }}">
        {{ listing.title }}
      </a>
    </h3>
    {% if listing.short_description %}
    <p class="mb-2 fs-sm text-muted">{{ listing.short_description|truncatewords:15 }}</p>
    {% endif %}
    {% if listing.has_price_display %}
    <div>
      <i class="fi-cash mt-n1 me-2 lead align-middle opacity-70"></i>
      {% if listing.deal == 'mortgage_rent' %}
        {% if listing.price_mortgage %}<span>رهن {{ listing.price_mortgage|floatformat:0|intcomma }}</span>{% endif %}
        {% if listing.price_mortgage and listing.price %} <span class="text-muted">|</span> {% endif %}
        {% if listing.price %}<span>اجاره {{ listing.price|floatformat:0|intcomma }}</span>{% endif %}
        {{ listing.price_unit|default:"تومان" }}
      {% else %}
        {{ listing.price|floatformat:0|intcomma }} {{ listing.price_unit|default:"تومان" }}
      {% endif %}
    </div>
    {% endif %}
  </div>
  <div class="card-footer d-flex align-items-center justify-content-center mx-3 pt-3 text-nowrap border-0 bg-transparent">
    {% if listing.area %}
    <span class="d-inline-block mx-1 px-2 fs-sm text-muted">
      <i class="fi-map-pin ms-1 mt-n1 fs-lg opacity-70"></i>{{ listing.area.fa_name }}
    </span>
    {% endif %}
  </div>
</div>
